---
title: "Control Flow"
description: "Conditionals, loops, and pattern matching in DOL"
lesson: 4
track: "dol-fundamentals"
duration: "20 minutes"
concepts: ["if/else", "match", "for loops", "while", "pattern matching"]
prev: "/dol/tutorials/003-functions"
next: "/dol/tutorials/005-collections"
---

# Control Flow

DOL provides familiar control flow constructs with some powerful additions like pattern matching. In this lesson, you'll learn how to make decisions and iterate over data.

## If Expressions

Unlike many languages, `if` in DOL is an **expression** that returns a value:

```dol
pub fun max(a: i64, b: i64) -> i64 {
  if a > b {
    a
  } else {
    b
  }
}

pub fun describe_number(n: i64) -> String {
  if n < 0 {
    "negative"
  } else if n == 0 {
    "zero"
  } else {
    "positive"
  }
}
```

Since `if` returns a value, you can assign it directly:

```dol
val status = if is_active { "active" } else { "inactive" }
```

## Match Expressions

Pattern matching is one of DOL's most powerful features:

```dol
pub fun is_primitive(ty: TypeExpr) -> bool {
  match ty.type {
    i8 { return true }
    i16 { return true }
    i32 { return true }
    i64 { return true }
    u8 { return true }
    u16 { return true }
    u32 { return true }
    u64 { return true }
    f32 { return true }
    f64 { return true }
    bool { return true }
    string { return true }
    char { return true }
    void { return true }
    _ { return false }
  }
}
```

The `_` is a wildcard that matches anything.

### Matching with Destructuring

Extract values while matching:

```dol
pub fun type_name(ty: TypeExpr) -> Option<String> {
  match ty.type {
    Named { path } {
      if path.length() > 0 {
        return Some(path[path.length() - 1].clone())
      }
      return None
    }
    Generic { name, args: _ } {
      return Some(name)
    }
    _ {
      return None
    }
  }
}
```

### Match Arms with Guards

Add conditions to match arms:

```dol
pub fun categorize(n: i64) -> String {
  match n {
    x if x < 0 => "negative",
    0 => "zero",
    x if x < 10 => "small positive",
    x if x < 100 => "medium",
    _ => "large"
  }
}
```

## For Loops

Iterate over collections:

```dol
pub fun find_nearby_nodes(pos: Vec3, max_dist: f64) -> List<Ui64> {
  result = []
  for (id, node) in this.nodes {
    dx = pos.x - node.position.x
    dy = pos.y - node.position.y
    dz = pos.z - node.position.z
    dist = (dx * dx + dy * dy + dz * dz).sqrt()
    if dist <= max_dist {
      result.push(id)
    }
  }
  return result
}
```

### Range Iteration

```dol
// Iterate from 0 to 9
for i in 0..10 {
  // process i
}

// Inclusive range: 0 to 10
for i in 0..=10 {
  // process i
}
```

## While Loops

Continue while a condition is true:

```dol
pub fun find_root(var n: i64) -> i64 {
  while n > 1 {
    n = n / 2
  }
  return n
}
```

## Loop with Break

Infinite loop until explicitly broken:

```dol
pub fun find_first_match(items: List<Item>, predicate: (Item) -> Bool) -> Option<Item> {
  var index = 0
  loop {
    if index >= items.len() {
      break None
    }
    val item = items[index]
    if predicate(item) {
      break Some(item)
    }
    index += 1
  }
}
```

## Pattern Types

DOL supports various patterns for matching:

### Literal Patterns

```dol
match value {
  42 => "the answer",
  0 => "zero",
  _ => "something else"
}
```

### Tuple Patterns

```dol
match point {
  (0, 0) => "origin",
  (x, 0) => "on x-axis",
  (0, y) => "on y-axis",
  (x, y) => "elsewhere"
}
```

### Struct Patterns

```dol
match node {
  MyceliumNode { connections: [], .. } => "isolated",
  MyceliumNode { connections, .. } if connections.len() == 1 => "tip",
  MyceliumNode { connections, .. } if connections.len() > 2 => "branch",
  _ => "relay"
}
```

### Variant Patterns

```dol
match expr.type {
  Expr.IntLit { value, suffix: None } => {
    // Integer literal
  }
  Expr.StringLit { value, is_raw: false } => {
    // String literal
  }
  Expr.Binary { op, left, right } => {
    // Binary operation
  }
  _ => {
    // Other expression
  }
}
```

### Or Patterns

Match multiple alternatives:

```dol
match state {
  ContainerState.Created | ContainerState.Starting => "initializing",
  ContainerState.Running => "active",
  ContainerState.Paused | ContainerState.Stopping | ContainerState.Stopped => "inactive",
  ContainerState.Removing | ContainerState.Removed => "cleanup"
}
```

## Early Returns with `?`

The `?` operator for early returns on `Option` and `Result`:

```dol
pub fun parse_config(text: String) -> Result<Config, Error> {
  let name = parse_name(text)?  // Returns Err if parse fails
  let port = parse_port(text)?
  let host = parse_host(text)?

  Ok(Config { name, port, host })
}
```

## Key Takeaways

- `if/else` are expressions that return values
- `match` enables powerful pattern matching with destructuring
- Patterns include literals, tuples, structs, variants, and wildcards
- Use guards (`if condition`) in match arms for complex conditions
- `for` iterates over collections, `while` loops on a condition
- The `?` operator enables early returns for `Option` and `Result`

## Practice Exercise

Write a function that categorizes container states:

```dol
pub gen ContainerState {
  type: enum {
    Created,
    Starting,
    Running,
    Paused,
    Stopping,
    Stopped,
    Removing,
    Removed
  }
}

pub fun describe_state(state: ContainerState) -> String {
  // Use match to return:
  // - "initializing" for Created, Starting
  // - "active" for Running
  // - "suspended" for Paused
  // - "shutting down" for Stopping, Stopped
  // - "cleanup" for Removing, Removed

  match state {
    // Your code here...
  }
}
```

## Next Steps

In the next lesson, we'll explore DOL's collection types and functional operations.

<div className="mt-8 flex justify-between">
  <a href="/dol/tutorials/003-functions" className="btn-secondary inline-flex items-center gap-2">← Previous: Functions</a>
  <a href="/dol/tutorials/005-collections" className="btn-primary inline-flex items-center gap-2">Next: Collections →</a>
</div>
